# Vulnerability Detection Schema Configuration File
# Define vulnerability detection schema including types, classifications, and sink points for different programming languages

# Java vulnerability detection schema - Three-level structure: Primary Type/Secondary Type/Component Type
java:
  # XML External Entity (XXE) vulnerabilities
  SSRF:
    SSRF:
      - SsrfURLopenConnection:
          file_type:
            type: code
          sinks:
            - class_regex: "java\\.net\\.URL"
              method_regex: "openConnection"
            - class_regex: "java\\.net\\.URL"
              method_regex: "openStream"
            - class_regex: "java\\.net\\.URL"
              method_regex: "getContent"
            - class_regex: "java\\.nio\\.channels\\.Channels"
              method_regex: "newChannel"
            - class_regex: "java\\.net\\.URL"
              method_regex: "URL"

      - SsrfApache:
          file_type:
            type: code
          sinks:
            - class_regex: "org\\.apache\\.commons\\.io\\.FileUtils"
              method_regex: ".*"
            - class_regex: "org\\.apache\\.commons\\.io\\.IOUtils"
              method_regex: "toByteArray"
            - class_regex: "org\\.apache\\.commons\\.io\\.IOUtils"
              method_regex: "toString"
            - class_regex: "org\\.apache\\.commons\\.io\\.file\\.PathUtils"
              method_regex: "copyFile"
            - class_regex: "org\\.apache\\.commons\\.io\\.file\\.PathUtils"
              method_regex: "copyFileToDirectory"
            - class_regex: "org\\.apache\\.http\\.client\\.methods\\.HttpGet"
              method_regex: "HttpGet"
            - class_regex: "java\\.net\\.URL"
              method_regex: "openStream"
      - ImageIO:
          file_type:
            type: code
          sinks:
            - class_regex: "javax\\.imageio\\.ImageIO"
              method_regex: "read"
      - SsrfHttpClient:
          file_type:
            type: code
          sinks:
            - class_regex: "org\\.apache\\.http\\.client\\.methods\\.HttpGet"
              method_regex: "HttpGet"
            - class_regex: "org\\.apache\\.http\\.impl\\.client\\.CloseableHttpClient"
              method_regex: "execute"
            - class_regex: "org\\.apache\\.http\\.impl\\.client\\.HttpClientBuilder"
              method_regex: "build"
            - class_regex: "org\\.eclipse\\.jetty\\.client\\.HttpClient"
              method_regex: "newRequest"
            - class_regex: "org\\.apache\\.http\\.client\\.methods\\.HttpPost"
              method_regex: "HttpPost"
            - class_regex: "okhttp3\\.OkHttpClient\\.Builder"
              method_regex: ".*"
            - class_regex: "okhttp3\\.OkHttpClient"
              method_regex: "newCall"
            - class_regex: "retrofit2\\.Retrofit\\.Builder"
              method_regex: ".*"
            - class_regex: "okhttp\\.OkHttpClient\\.Builder"
              method_regex: ".*"

      - SsrfOkHttp:
          file_type:
            type: code
          sinks:
            - class_regex: "okhttp3\\.Request\\.Builder"
              method_regex: "url"
            - class_regex: "com\\.squareup\\.okhttp\\.Request\\.Builder"
              method_regex: "url"
            - class_regex: "okhttp3\\.OkHttpClient"
              method_regex: "newCall"
            - class_regex: "retrofit2\\.Retrofit\\.Builder"
              method_regex: "baseUrl"
      - RestTemplate:
          file_type:
            type: code
          sinks:
            - class_regex: "org\\.springframework\\.web\\.client\\.RestTemplate"
              method_regex: "getForObject"
            - class_regex: "org\\.springframework\\.web\\.client\\.RestTemplate"
              method_regex: "exchange"
            - class_regex: "org\\.springframework\\.web\\.client\\.RestTemplate"
              method_regex: "postForEntity"
            - class_regex: "org\\.springframework\\.web\\.client\\.RestTemplate" 
              method_regex: "RestTemplate"
      - JsoUp:
          file_type:
            type: code
          sinks:
            - class_regex: "org\\.jsoup\\.Jsoup"
              method_regex: "connect"

  XXE:
    XXE:
      - XxeDigester:
          file_type:
            type: code
          sinks:
            - class_regex: "org\\.apache\\.commons\\.digester\\.Digester"
              method_regex: "parse"
      - XxeDocumentBuilderFactory:
          file_type:
            type: code
          sinks:
            - class_regex: "javax\\.xml\\.parsers\\.DocumentBuilder"
              method_regex: "parse"
      - XxeInputFactory:
          file_type:
            type: code
          sinks:
            - class_regex: ".+\\.XMLInputFactory"
              method_regex: "createXMLStreamReader"
            - class_regex: "com\\.sun\\.xml\\.internal\\.fastinfoset\\.stax\\.factory\\.StAXInputFactory"
              method_regex: "createXMLStreamReader"
            - class_regex: "com\\.sun\\.xml\\.internal\\.stream\\.XMLInputFactoryImpl"
              method_regex: "createXMLStreamReader"
            - class_regex: ".+\\.XMLInputFactory"
              method_regex: "createXMLEventReader"
            - class_regex: "com\\.sun\\.xml\\.internal\\.fastinfoset\\.stax\\.factory\\.StAXInputFactory"
              method_regex: "createXMLEventReader"
            - class_regex: "com\\.sun\\.xml\\.internal\\.stream\\.XMLInputFactoryImpl"
              method_regex: "createXMLEventReader"
      - XxeSaxParserFactory:
          file_type:
            type: code
          sinks:
            - class_regex: "javax\\.xml\\.parsers\\.SAXParser"
              method_regex: "parse"
      - XxeSchemaFactory:
          file_type:
            type: code
          sinks:
            - class_regex: "javax\\.xml\\.validation\\.SchemaFactory"
              method_regex: "newSchema"
      - XxeTransformerFactory:
          file_type:
            type: code
          sinks:
            - class_regex: "javax\\.xml\\.transform\\.Transformer"
              method_regex: "transform"
      - XxeUnmarshaller:
          file_type:
            type: code
          sinks:
            - class_regex: "javax\\.xml\\.bind\\.Unmarshaller"
              method_regex: "unmarshal"
      - XxeValidator:
          file_type:
            type: code
          sinks:
            - class_regex: "javax\\.xml\\.validation\\.Validator"
              method_regex: "validate"
      - XxeXMLReader:
          file_type:
            type: code
          sinks:
            - class_regex: "org\\.xml\\.sax\\.XMLReader"
              method_regex: "parse"
      - XxeXpathExpression:
          file_type:
            type: code
          sinks:
            - class_regex: "javax\\.xml\\.xpath\\.XPathExpression"
              method_regex: "evaluate"
      - XxeSaxBuilder:
          file_type:
            type: code
          sinks:
            - class_regex: "org\\.jdom2\\.input\\.SAXBuilder"
              method_regex: "build"
      - XxeSaxReader:
          file_type:
            type: code
          sinks:
            - class_regex: "org\\.dom4j\\.io\\.SAXReader"
              method_regex: "read"

  # Misconfiguration vulnerabilities
  SecurityMisconfiguration:
    SecurityMisconfiguration:
      - SpringBootActuator:
          file_type:
            type: properties
          sinks:
            - class_regex: "management\\.security\\.enabled"
              method_regex: ".*"
            - class_regex: "endpoints\\.sensitive"
              method_regex: ".*"
            - class_regex: "endpoints\\.enabled"
              method_regex: ".*"
            - class_regex: "endpoints\\.info\\.enabled"
              method_regex: ".*"
            - class_regex: "endpoints\\.health\\.enabled"
              method_regex: ".*"
            - class_regex: "endpoints\\.env\\.post\\.enabled"
              method_regex: ".*"
            - class_regex: "endpoints\\.env\\.enabled"
              method_regex: ".*"
            - class_regex: "endpoints\\.heapdump\\.enabled"
              method_regex: ".*"
            - class_regex: "management\\.port"
              method_regex: ".*"
            - class_regex: "management\\.address"
              method_regex: ".*"
            - class_regex: "management\\.endpoints\\.web\\.exposure\\.include"
              method_regex: ".*"
            - class_regex: "management\\.endpoints\\.web\\.exposure\\.exclude"
              method_regex: ".*"
            - class_regex: "management\\.endpoint\\.env\\.post\\.enabled"
              method_regex: ".*"
            - class_regex: "management\\.server\\.port"
              method_regex: ".*"
            - class_regex: "management\\.server\\.address"
              method_regex: ".*"


  # Supply chain vulnerabilities
  SupplyChain:
    SupplyChain:
      - Fastjson:
          file_type:
            type: xml
            sub_type: pom
      - Log4j:
          file_type:
            type: xml
            sub_type: pom
  Credentials:
    HardCode:
      - AkSkHardCode:
          file_type:
            type: code
          sinks:
            - class_regex: ".*"
              method_regex: ".*setAccessKeyId"
            - class_regex: ".*"
              method_regex: ".*setAccessKeySecret"
            - class_regex: ".*"
              method_regex: ".*withAccessKeyId"
            - class_regex: ".*"
              method_regex: ".*withAccessKeySecret"
            - class_regex: ".*OSSClientBuilder"
              method_regex: "build"

  FileHandle:
    FileWrite:
      - FileWrite:
          file_type:
            type: code
          sinks:
            - class_regex: "java\\.io\\.FileOutputStream"
              method_regex: "FileOutputStream"

    FileRead:
      - FileRead:
          file_type:
            type: code
          sinks:
            - class_regex: "java\\.io\\.FileInputStream"
              method_regex: "FileInputStream"

    FileUnzip:
      - FileUnzip:
          file_type:
            type: code
          sinks:
            - class_regex: "java\\.io\\.FileOutputStream"
              method_regex: "FileOutputStream"

  Deserialization:
    Deserialization:
      - DeserObjectInputStream:
          file_type:
            type: code
          sinks:
            - class_regex: "java\\.io\\.ObjectInputStream"
              method_regex: "readObject"
      - DeserXMLDecoder:
          file_type:
            type: code
          sinks:
            - class_regex: "java\\.beans\\.XMLDecoder"
              method_regex: "readObject"
      - DeserCastorXML:
          file_type:
            type: code
          sinks:
            - class_regex: "org\\.exolab\\.castor\\.xml\\.Unmarshaller"
              method_regex: "unmarshal"
      - DeserHessian:
          file_type:
            type: code
          sinks:
            - class_regex: "com\\.caucho\\.hessian\\.io\\.Hessian2?Input"
              method_regex: "readObject"
      - DeserSnakeYaml:
          file_type:
            type: code
          sinks:
            - class_regex: "org\\.yaml\\.snakeyaml\\.Yaml"
              method_regex: "load"
            - class_regex: "org\\.yaml\\.snakeyaml\\.Yaml"
              method_regex: "loadAll"
            - class_regex: "org\\.yaml\\.snakeyaml\\.Yaml"
              method_regex: "loadAs"
      - DeserJackson:
          file_type:
            type: code
          sinks:
            - class_regex: "com\\.fasterxml\\.jackson\\.databind\\.ObjectMapper"
              method_regex: "readValue"
      - DeserFastjson:
          file_type:
            type: code
          sinks:
            - class_regex: "com\\.alibaba\\.fastjson\\.JSON"
              method_regex: "parseArray"
            - class_regex: "com\\.alibaba\\.fastjson\\.JSON"
              method_regex: "parseObject"
            - class_regex: "com\\.alibaba\\.fastjson\\.JSONObject"
              method_regex: "parseArray"
            - class_regex: "com\\.alibaba\\.fastjson\\.JSONObject"
              method_regex: "parseObject"
            - class_regex: "com\\.alibaba\\.fastjson\\.JSONArray"
              method_regex: "parseArray"
            - class_regex: "com\\.alibaba\\.fastjson\\.JSONArray"
              method_regex: "parseObject"
      - DeserFlexJson:
          file_type:
            type: code
          sinks:
            - class_regex: "flexjson\\.JSONDeserializer"
              method_regex: "deserialize"
      - DeserJoddJson:
          file_type:
            type: code
          sinks:
            - class_regex: "jodd\\.json\\.JsonParser"
              method_regex: "parse"


  # Injection vulnerabilities
  Injection:
    SQLInjection:
      - Mybatis:
          file_type:
            type: xml
            sub_type: mybatis
      - InjectionJDBC:
          file_type:
            type: code
          sinks:
            - class_regex: "java\\.sql\\.Statement"
              method_regex: "executeQuery"
            - class_regex: "java\\.sql\\.Statement"
              method_regex: "execute"
            - class_regex: "java\\.sql\\.Statement"
              method_regex: "executeUpdate"
            - class_regex: "java\\.sql\\.Statement"
              method_regex: "addBatch"
            - class_regex: "java\\.sql\\.Statement"
              method_regex: "executeLargeUpdate"
            - class_regex: "java\\.sql\\.PreparedStatement"
              method_regex: "executeQuery"
            - class_regex: "java\\.sql\\.PreparedStatement"
              method_regex: "execute"
            - class_regex: "java\\.sql\\.PreparedStatement"
              method_regex: "executeUpdate"
            - class_regex: "java\\.sql\\.PreparedStatement"
              method_regex: "addBatch"
            - class_regex: "java\\.sql\\.PreparedStatement"
              method_regex: "executeLargeUpdate"
            - class_regex: "java\\.sql\\.Connection"
              method_regex: "prepareStatement"
            - class_regex: "java\\.sql\\.Connection"
              method_regex: "nativeSQL"
            - class_regex: "java\\.sql\\.Connection"
              method_regex: "prepareCall"
      - InjectionJdbcTemplate:
          file_type:
            type: code
          sinks:
            - class_regex: ".*\\.?JdbcTemplate"
              method_regex: "batchUpdate"
            - class_regex: ".*\\.?JdbcTemplate"
              method_regex: "execute"
            - class_regex: ".*\\.?JdbcTemplate"
              method_regex: "query.*"
            - class_regex: ".*\\.?JdbcTemplate"
              method_regex: "update"
            - class_regex: "org\\.springframework\\.jdbc\\.core\\.namedparam\\.NamedParameterJdbcTemplate"
              method_regex: "execute"
            - class_regex: "org\\.springframework\\.jdbc\\.core\\.namedparam\\.NamedParameterJdbcTemplate"
              method_regex: "query.*"
            - class_regex: "org\\.springframework\\.jdbc\\.core\\.namedparam\\.NamedParameterJdbcTemplate"
              method_regex: "update"
            - class_regex: "org\\.springframework\\.jdbc\\.core\\.namedparam\\.NamedParameterJdbcOperations"
              method_regex: "execute"
            - class_regex: "org\\.springframework\\.jdbc\\.core\\.namedparam\\.NamedParameterJdbcOperations"
              method_regex: "query.*"
            - class_regex: "org\\.springframework\\.jdbc\\.core\\.namedparam\\.NamedParameterJdbcOperations"
              method_regex: "update"
    CommadInjection:
      - InjectionProcessBuilder:
          file_type:
            type: code
          sinks:
            - class_regex: ".*"
              method_regex: "ProcessBuilder"
            - class_regex: ".*"
              method_regex: "start"
      - InjectionRuntimeExec:
          file_type:
            type: code
          sinks:
            - class_regex: "Runtime"
              method_regex: "getRuntime"
            - class_regex: ".*"
              method_regex: "exec"
    ExpressionInjection:
      - InjectionGroovy:
          file_type:
            type: code
          sinks:
            - class_regex: "groovy\\.lang\\.GroovyShell"
              method_regex: "GroovyShell"
            - class_regex: "groovy\\.lang\\.GroovyShell"
              method_regex: "evaluate"
            - class_regex: "groovy\\.lang\\.GroovyClassLoader"
              method_regex: "parseClass"
      - InjectionSpringSpel:
          file_type:
            type: code
          sinks:
            - class_regex: "org\\.springframework\\.expression\\.Expression"
              method_regex: "getValue"
            - class_regex: "org\\.springframework\\.expression\\.ExpressionParser"
              method_regex: "parseExpression"
            - class_regex: "org\\.springframework\\.expression\\.spel\\.standard\\.SpelExpressionParser"
              method_regex: "parseExpression"
      - InjectionOgnl:
          file_type:
            type: code
          sinks:
            - class_regex: "ognl\\.Ognl"
              method_regex: "parseExpression"
            - class_regex: "ognl\\.Ognl"
              method_regex: "getValue"
            - class_regex: "ognl\\.Ognl"
              method_regex: "setValue"
            - class_regex: "org\\.apache\\.commons\\.ognl\\.Ognl"
              method_regex: "parseExpression"
            - class_regex: "org\\.apache\\.commons\\.ognl\\.Ognl"
              method_regex: "getValue"
            - class_regex: "org\\.apache\\.commons\\.ognl\\.Ognl"
              method_regex: "setValue"
    JDBCInjection:
      - InjectionDriverManager:
          file_type:
            type: code
          sinks:
            - class_regex: "java\\.sql\\.DriverManager"
              method_regex: "getConnection"
    ServerSideTemplateInjection:
      - InjectionFreeMarker:
          file_type:
            type: code
          sinks:
            - class_regex: ".*"
              method_regex: "processTemplateIntoString"
            - class_regex: "freemarker.template.Template"
              method_regex: "process"
            - class_regex: ".*"
              method_regex: "Template"
      - InjectionVelocity:
          file_type:
            type: code
          sinks:
            - class_regex: "org\\.apache\\.velocity\\.app\\.Velocity(Engine)?"
              method_regex: "evaluate"

